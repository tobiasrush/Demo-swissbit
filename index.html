<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iShield Key + ZSM | Hardware WebAuthn Demo</title>
  <link rel="stylesheet" href="./style.css">
  <script type="importmap">
  {
    "imports": {
      "@ideem/zsm-client-sdk": "./vendor/@ideem/zsm-client-sdk/ZSMClientSDK.js",
      "@ideem/zsm-client-sdk/": "./vendor/@ideem/zsm-client-sdk/",
      "@ideem/plugins.passkeys-plus": "./vendor/@ideem/plugins.passkeys-plus/PasskeysPlus.js",
      "@ideem/plugins.passkeys-plus/": "./vendor/@ideem/plugins.passkeys-plus/"
    }
  }
  </script>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="logo-row">
      <img src="./swissbit_logo.png" alt="Swissbit" class="logo logo-swissbit">
      <span class="logo-divider"></span>
      <img src="./ideem-logo.png" alt="Ideem" class="logo logo-ideem">
    </div>
    <h1>iShield Key + ZSM</h1>
    <p class="subtitle">Hardware WebAuthn Demo</p>
  </header>

  <!-- Main Card -->
  <main class="card">

    <!-- Username — always visible -->
    <div class="username-row">
      <label for="username">User ID</label>
      <input type="text" id="username" placeholder="Enter your user ID" autocomplete="off">
    </div>

    <!-- SETUP screen — new device, no credentials -->
    <div class="screen active" id="SETUP">
      <button id="trust-device-btn" class="btn btn-primary" disabled>Trust Device</button>
    </div>

    <!-- LOGIN screen — device trusted, user logged out -->
    <div class="screen" id="LOGIN">
      <div class="toggle-row">
        <label class="toggle-label" for="login-use-passkeys">Passkeys+</label>
        <label class="toggle-switch">
          <input type="checkbox" id="login-use-passkeys" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      <button id="login-btn" class="btn btn-primary">Login</button>
    </div>

    <!-- ACTIONS screen — logged in -->
    <div class="screen" id="ACTIONS">
      <div class="toggle-row">
        <label class="toggle-label" for="actions-use-passkeys">Use Passkeys</label>
        <label class="toggle-switch">
          <input type="checkbox" id="actions-use-passkeys" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="action-grid">
        <button class="btn btn-action" data-action="make-payment">Make Payment</button>
        <button class="btn btn-action" data-action="transfer-money">Transfer Money</button>
        <button class="btn btn-action" data-action="change-setting">Change Setting</button>
        <button class="btn btn-action" data-action="add-beneficiary">Add Beneficiary</button>
      </div>

      <div id="action-status" class="flash" role="status" aria-live="polite"></div>

      <button id="logout-btn" class="btn btn-secondary">Log Out</button>

      <div class="challenge-display" id="ishield-challenge-display" hidden>
        <div class="challenge-section-header">
          <span class="challenge-section-label">iShield Key</span>
          <img src="./swissbit.png" alt="iShield" id="icon-ishield" class="auth-icon">
        </div>
        <details id="ishield-challenge-details">
          <summary>Challenge: <span id="ishield-challenge-preview" class="challenge-value">--</span><button class="btn-copy" aria-label="Copy value" onclick="event.stopPropagation()">
  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
  </svg>
</button></summary>
          <pre class="challenge-full" id="ishield-challenge-full"></pre>
        </details>
        <details id="ishield-signed-challenge-details">
          <summary>Signed Challenge: <span id="ishield-signed-challenge-preview" class="challenge-value">--</span><button class="btn-copy" aria-label="Copy value" onclick="event.stopPropagation()">
  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
  </svg>
</button></summary>
          <pre class="challenge-full" id="ishield-signed-challenge-full"></pre>
        </details>
      </div>
      <div class="challenge-display" id="passkeys-challenge-display" hidden>
        <div class="challenge-section-header">
          <span class="challenge-section-label">Passkeys+</span>
          <img src="./zsm_chip.png" alt="ZSM" id="icon-zsm" class="auth-icon" hidden>
          <img src="./passkeys.png" alt="Passkeys" id="icon-passkeys" class="auth-icon" hidden>
        </div>
        <details id="challenge-details">
          <summary>Challenge: <span id="challenge-preview" class="challenge-value">--</span><button class="btn-copy" aria-label="Copy value" onclick="event.stopPropagation()">
  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
  </svg>
</button></summary>
          <pre class="challenge-full" id="challenge-full"></pre>
        </details>
        <details id="signed-challenge-details">
          <summary>Signed Challenge: <span id="signed-challenge-preview" class="challenge-value">--</span><button class="btn-copy" aria-label="Copy value" onclick="event.stopPropagation()">
  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
  </svg>
</button></summary>
          <pre class="challenge-full" id="signed-challenge-full"></pre>
        </details>
      </div>
    </div>

    <!-- Status pills — always visible -->
    <div class="status-pills">
      <span class="pill">iShield: <b id="ishield-status">--</b></span>
      <span class="pill">ZSM: <b id="zsm-status">--</b></span>
      <span class="pill">Passkey: <b id="passkey-status">--</b></span>
      <span class="pill">Passkeys+: <b id="passkeys-plus-status">--</b></span>
    </div>

    <!-- Flash message for enrollment feedback -->
    <div id="flash-status" class="flash" role="status" aria-live="polite"></div>

  </main>

  <!-- Confirmation Popup -->
  <div id="confirm-popup" class="popup-overlay" role="dialog" aria-modal="true" aria-labelledby="popup-message">
    <div class="popup-card">
      <p id="popup-message"></p>
      <div class="popup-buttons">
        <button id="popup-cancel" class="btn btn-secondary">Cancel</button>
        <button id="popup-continue" class="btn btn-primary">Continue</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <button id="suspend-device" class="btn btn-warning-small" disabled>Suspend Device</button>
    <button id="reset-device" class="btn btn-danger-small">Reset Device</button>
  </footer>

  <!-- Screen reader announcements -->
  <div id="screen-announcer" class="sr-only" aria-live="assertive"></div>

  <!-- Scripts -->
  <script src="./state.js"></script>
  <script type="module" src="./app.js"></script>

</body>
</html>
